#!/bin/sh
#
# CIP Core, generic profile
#
# Copyright (c) Siemens AG, 2023
#
# Authors:
#  Su Bao Cheng <baocheng.su@siemens.com>
#
# SPDX-License-Identifier: MIT
#
PREREQ=""
prereqs()
{
    echo "$PREREQ"
}
case $1 in
prereqs)
    prereqs
    exit 0
    ;;
esac

. /usr/share/initramfs-tools/hook-functions

hook_error() {
    echo "(ERROR): $2" >&2
    exit 1
}

# Just in case these modules are not built-in. For stock debian arm64 kernel,
# the tee.ko and the optee.ko exist since bookworm; the tpm_ftpm_tee.ko does not
# exist in any stock debian kernels, it could be provided by customized kernel.
manual_add_modules tee
manual_add_modules optee
manual_add_modules tpm_ftpm_tee

copy_exec /usr/sbin/tee-supplicant || hook_error "/usr/sbin/tee-supplicant not found"
