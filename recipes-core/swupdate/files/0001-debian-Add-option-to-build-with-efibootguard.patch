From fe3f090e3764e1e2625d509a56bd521bab507ce7 Mon Sep 17 00:00:00 2001
From: Quirin Gylstorff <quirin.gylstorff@siemens.com>
Date: Wed, 15 Sep 2021 12:36:09 +0200
Subject: [PATCH 1/9] debian: Add option to build with efibootguard

Signed-off-by: Quirin Gylstorff <quirin.gylstorff@siemens.com>
---
 debian/control | 1 +
 debian/rules   | 2 ++
 2 files changed, 3 insertions(+)

diff --git a/debian/control b/debian/control
index 9e43eab..6031537 100644
--- a/debian/control
+++ b/debian/control
@@ -28,6 +28,7 @@ Build-Depends: debhelper-compat (= 13),
                libwebsockets-dev (>= 3.2.0) <!pkg.swupdate.bpo>,
                liburiparser-dev <!pkg.swupdate.bpo>,
                libubootenv-dev <pkg.swupdate.uboot>,
+               efibootguard-dev <pkg.swupdate.efibootguard>,
                libcmocka-dev,
                pkg-config,
                gawk,
diff --git a/debian/rules b/debian/rules
index 4b55be2..c076839 100755
--- a/debian/rules
+++ b/debian/rules
@@ -33,6 +33,8 @@ ifneq (,$(filter pkg.swupdate.uboot,$(DEB_BUILD_PROFILES)))
 else ifneq (,$(filter pkg.swupdate.grub,$(DEB_BUILD_PROFILES)))
 	echo CONFIG_BOOTLOADER_GRUB=y                   >> configs/debian_defconfig
 	echo CONFIG_GRUBENV_PATH=\"/boot/grub/grubenv\" >> configs/debian_defconfig
+else ifneq (,$(filter pkg.swupdate.efibootguard,$(DEB_BUILD_PROFILES)))
+	echo CONFIG_BOOTLOADER_EBG=y                    >> configs/debian_defconfig
 else
 	echo CONFIG_BOOTLOADER_NONE=y                   >> configs/debian_defconfig
 endif
-- 
2.30.2

